---
import Menu from '@/assets/icons/menu.astro'
import X from '@/assets/icons/x.astro'

import { routes } from '@data'

const { pathname } = Astro.url

function isActive(path: string) {
  return path === pathname
}

console.log('Pathname: ', pathname)

let isMenuOpen = false
---

<header
  id="navbar"
  class="w-full fixed top-0 left-0 z-50 h-20 md:h-24 md:px-24 sm:overflow-hidden rounded-sm"
>
  <div
    class="w-full max-w-380 m-auto flex items-center justify-between px-4 py-6"
  >
    <a href="/"><h3 class="text-xl font-semibold">MNC. Mónica Martínez</h3></a>

    <nav class="hidden md:flex items-center gap-6">
      <ul class="flex items-center justify-center gap-6">
        {
          routes.map((route) => (
            <li
              class={` ${isActive(route.path) ? 'text-primary-hover font-semibold' : 'text-text-muted hover:text-primary transition-colors'}`}
            >
              <a href={route.path}>{route.name}</a>
            </li>
          ))
        }
      </ul>
      <a
        href="/schedule"
        class="font-semibold bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-hover transition-colors"
        >Agendar Cita</a
      >
    </nav>

    <button class="md:hidden p-2 text-text" id="menu-toggle">
      {isMenuOpen ? <X /> : <Menu />}
    </button>
  </div>

  <!-- Mobile Navigation -->
  <nav
    id="mobile-menu"
    class="md:hidden -mt-2 py-4 flex-col gap-4 border-t border-gray-300 bg-background hidden border rounded-b-lg h-screen"
  >
    {
      routes.map((route) => (
        <a
          href={route.path}
          class={`block px-4 py-2 ${isActive(route.path) ? 'text-primary-hover font-semibold' : 'text-text-muted hover:text-primary transition-colors'}`}
        >
          {route.name}
        </a>
      ))
    }
    <a
      href="/schedule"
      class="block text-center font-semibold bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-hover transition-colors mx-4 w-full max-w-4/5"
    >
      Agendar Cita
    </a>
  </nav>
</header>

<script is:inline>
  function setupMenu() {
    const menuToggle = document.getElementById('menu-toggle')
    const mobileMenu = document.getElementById('mobile-menu')

    menuToggle?.addEventListener('click', () => {
      mobileMenu?.classList.toggle('hidden')
      mobileMenu?.classList.toggle('flex')
    })
  }

  // Ejecutar al cargar
  setupMenu()

  // Re-ejecutar después de navegación
  document.addEventListener('astro:page-load', setupMenu)
</script>
